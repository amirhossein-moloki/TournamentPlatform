# مستندات عامل

این فایل به عنوان یک راهنمای سریع برای توسعه‌دهندگان و عامل‌های هوش مصنوعی برای کار با این پروژه عمل می‌کند.

## دستورات رایج

در ادامه لیستی از دستورات رایج مورد استفاده در این پروژه آورده شده است:

### نصب وابستگی‌ها

```bash
npm install
```

### اجرای برنامه

- **حالت توسعه (با Nodemon):**
  ```bash
  npm run dev
  ```
- **حالت تولید:**
  ```bash
  npm start
  ```

### لینت و فرمت‌بندی

- **لینت کردن کد:**
  ```bash
  npm run lint
  ```
- **فرمت‌بندی کد:**
  ```bash
  npm run format
  ```

### مدیریت پایگاه داده

- **اعمال مایگریشن‌ها:**
  ```bash
  npm run db:migrate
  ```
- **بازگردانی مایگریشن‌ها:**
  ```bash
  npm run db:migrate:undo
  ```
- **سیدینگ پایگاه داده:**
  ```bash
  npm run db:seed
  ```
- **حذف داده‌های سید شده:**
  ```bash
  npm run db:seed:undo
  ```

### تولید مستندات Swagger

```bash
npm run swagger-gen
```

### دستورات Docker

- **ساخت ایمیج Docker:**
  ```bash
  npm run docker:build
  ```
- **اجرای سرویس‌ها با Docker Compose:**
  ```bash
  npm run docker:run
  ```
- **متوقف کردن سرویس‌های Docker Compose:**
  ```bash
  npm run docker:stop
  ```
- **مشاهده لاگ‌های کانتینر برنامه:**
  ```bash
  npm run docker:logs
  ```

### اجرای تست‌ها

- **اجرای همه تست‌ها:**
  ```bash
  npm test
  ```
- **اجرای تست‌های واحد:**
  ```bash
  npm run test:unit
  ```
- **اجرای تست‌های یکپارچه‌سازی:**
  ```bash
  npm run test:integration
  ```
- **اجرای تست‌های End-to-End:**
  ```bash
  npm run test:e2e
  ```
- **اجرای تست‌های قرارداد (Contract):**
  ```bash
  npm run test:contract
  ```
- **اجرای تست‌های عملکرد (Performance):**
  ```bash
  npm run test:performance
  ```

## بررسی اسکریپت‌های `package.json`

در ادامه، جزئیات بیشتری در مورد هر یک از اسکریپت‌های تعریف شده در `package.json` ارائه می‌شود:

- **`start`**: برنامه را در حالت تولید اجرا می‌کند. این اسکریپت فایل `server.js` را با استفاده از `node` اجرا می‌کند.
- **`dev`**: برنامه را در حالت توسعه با استفاده از `nodemon` اجرا می‌کند. `nodemon` به طور خودکار سرور را پس از هر تغییر در فایل‌ها راه‌اندازی مجدد می‌کند.
- **`lint`**: کدبیس را با استفاده از `ESLint` بررسی می‌کند تا مشکلات و خطاهای احتمالی را شناسایی کند.
- **`format`**: فایل‌های پروژه را با استفاده از `Prettier` فرمت‌بندی می‌کند تا از یکپارچگی سبک کد اطمینان حاصل شود.
- **`test`**: تمام تست‌های پروژه (واحد، یکپارچه‌سازی و غیره) را با استفاده از `Jest` اجرا می‌کند.
- **`test:unit`**: فقط تست‌های واحد را اجرا می‌کند.
- **`test:integration`**: تست‌های یکپارچه‌سازی را اجرا می‌کند. این اسکریپت ابتدا سرویس‌های مورد نیاز را با `docker-compose` راه‌اندازی کرده، سپس تست‌ها را اجرا و در نهایت سرویس‌ها را متوقف می‌کند.
- **`test:e2e`**: تست‌های End-to-End را اجرا می‌کند.
- **`test:contract`**: تست‌های قرارداد را اجرا می‌کند.
- **`test:performance`**: تست‌های عملکرد را اجرا می‌کند.
- **`db:migrate`**: مایگریشن‌های پایگاه داده را با استفاده از `sequelize-cli` اعمال می‌کند.
- **`db:migrate:undo`**: آخرین مایگریشن اعمال شده را بازگردانی می‌کند.
- **`db:seed`**: داده‌های اولیه (seed) را در پایگاه داده قرار می‌دهد.
- **`db:seed:undo`**: داده‌های اولیه قرار داده شده را حذف می‌کند.
- **`swagger-gen`**: مستندات API را با استفاده از `swagger-autogen` تولید می‌کند.
- **`docker:build`**: یک ایمیج Docker از برنامه می‌سازد.
- **`docker:run`**: سرویس‌های تعریف شده در `docker-compose.yml` را راه‌اندازی می‌کند.
- **`docker:stop`**: سرویس‌های در حال اجرا را متوقف می‌کند.
- **`docker:logs`**: لاگ‌های کانتینر برنامه را نمایش می‌دهد.

## مستندسازی دستورات `docker`

دستورات زیر برای مدیریت برنامه با استفاده از Docker و Docker Compose در نظر گرفته شده‌اند:

- **`docker:build`**:
  - **دستور:** `docker build -t tournament-platform .`
  - **توضیح:** این دستور یک ایمیج Docker از برنامه با نام `tournament-platform` می‌سازد. `Dockerfile` موجود در ریشه پروژه، دستورالعمل‌های لازم برای ساخت این ایمیج را فراهم می‌کند.

- **`docker:run`**:
  - **دستور:** `docker-compose up -d`
  - **توضیح:** این دستور سرویس‌های تعریف شده در فایل `docker-compose.yml` را در حالت detached (پس‌زمینه) راه‌اندازی می‌کند. این سرویس‌ها معمولاً شامل برنامه اصلی، پایگاه داده (PostgreSQL)، کش (Redis) و صف پیام (RabbitMQ) می‌شوند.

- **`docker:stop`**:
  - **دستور:** `docker-compose down`
  - **توضیح:** این دستور تمام کانتینرهای راه‌اندازی شده توسط `docker-compose up` را متوقف و حذف می‌کند.

- **`docker:logs`**:
  - **دستور:** `docker-compose logs -f app`
  - **توضیح:** این دستور لاگ‌های مربوط به سرویس `app` (برنامه اصلی) را به صورت زنده نمایش می‌دهد. فلگ `-f` به معنای "follow" است و باعث می‌شود که لاگ‌ها به صورت مستمر نمایش داده شوند.

## مستندسازی دستورات تست

این پروژه از Jest برای تست‌نویسی استفاده می‌کند. در ادامه، دستورات مختلف برای اجرای تست‌ها توضیح داده شده‌اند:

- **`test`**:
  - **دستور:** `NODE_ENV=test jest`
  - **توضیح:** این دستور تمام تست‌های موجود در پروژه را اجرا می‌کند. `NODE_ENV=test` متغیر محیطی را برای اجرای تست‌ها تنظیم می‌کند.

- **`test:unit`**:
  - **دستور:** `NODE_ENV=test jest --testPathPattern=tests/unit`
  - **توضیح:** این دستور فقط تست‌های واحد (unit tests) را که در دایرکتوری `tests/unit` قرار دارند، اجرا می‌کند.

- **`test:integration`**:
  - **دستور:** `docker-compose -f docker-compose.test.yml up -d > docker-compose.log 2>&1 && sleep 15 && NODE_ENV=test jest --testPathPattern=tests/integration && docker-compose -f docker-compose.test.yml down`
  - **توضیح:** این یک اسکریپت پیچیده‌تر است که:
    1.  سرویس‌های مورد نیاز برای تست‌های یکپارچه‌سازی را با استفاده از `docker-compose.test.yml` راه‌اندازی می‌کند.
    2.  ۱۵ ثانیه صبر می‌کند تا سرویس‌ها به طور کامل راه‌اندازی شوند.
    3.  تست‌های یکپارچه‌سازی موجود در دایرکتوری `tests/integration` را اجرا می‌کند.
    4.  پس از اتمام تست‌ها، سرویس‌های Docker را متوقف می‌کند.

- **`test:e2e`**:
  - **دستور:** `NODE_ENV=test jest --testPathPattern=tests/e2e`
  - **توضیح:** این دستور تست‌های End-to-End را که در دایرکتوری `tests/e2e` قرار دارند، اجرا می‌کند.

- **`test:contract`**:
  - **دستور:** `NODE_ENV=test jest --testPathPattern=tests/contract`
  - **توضیح:** این دستور تست‌های قرارداد (contract tests) را که در دایرکتوری `tests/contract` قرار دارند، اجرا می‌کند.

- **`test:performance`**:
  - **دستور:** `NODE_ENV=test jest --testPathPattern=tests/performance`
  - **توضیح:** این دستور تست‌های عملکرد (performance tests) را که در دایرکتوری `tests/performance` قرار دارند، اجرا می‌کند.

## ساختار پروژه

پروژه از معماری پاک (Clean Architecture) پیروی می‌کند. ساختار کلی به شرح زیر است:

- `src/application`: شامل موارد استفاده و منطق خاص برنامه.
- `src/domain`: شامل منطق اصلی کسب‌وکار، موجودیت‌ها و رابط‌های ریپازیتوری.
- `src/infrastructure`: شامل اتصالات پایگاه داده، آداپتورهای سرویس‌های خارجی و پیاده‌سازی‌های دیگر.
- `src/presentation`: شامل مسیرهای API، کنترل‌کننده‌های WebSocket و کنترل‌کننده‌های وب‌هوک.
- `src/middleware`: شامل میان‌افزارهای Express.
- `src/workers`: شامل پردازنده‌های کارهای پس‌زمینه.
- `src/utils`: شامل ابزارهای کمکی مشترک.

برای اطلاعات بیشتر، به فایل `README.md` مراجعه کنید.
